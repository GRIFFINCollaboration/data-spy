<html>
    <head>
        <title>GRIFFIN Data Spy</title>

        <script src="scripts/jquery1-11-3.min.js" type="text/javascript"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <script src="scripts/bootstrap3-3-5.min.js" type="text/javascript"></script>

        <script src='scripts/mustache.js' type="text/javascript"></script>

        <script src='scripts/data-spy.js' type="text/javascript"></script>
        <script src='scripts/parse.js' type="text/javascript"></script>
        <link rel="stylesheet" href="css/data-spy.css">
    </head>

    <body>

        <div class='branding header'>
            <div class='col-md-1'>
                <img src='img/logo.gif'></img>
            </div>
            <div class='col-md-11'>
                <h1>GRIFFIN Data Spy</h1>
            </div>
        </div>

        <div id='warningsDiv' class='col-md-8 col-md-offset-2 warnings'></div>

        <div class='col-md-4 col-md-offset-2' id='leftTable'></div>
        <div class='col-md-4' id='rightTable'></div>

        <script>

            var i,
                words = defineTableStructure(),
                ODBrequest = 'http://grsmid00.triumf.ca:8081/?cmd=jcopy&odb0=/Runinfo/Run number&encoding=json-p-nokeys&callback=parseODB',
                templates = [
                    'parsingTable',
                    'warningsList'
                ]
            dataStore = {};

            //fetch the templates, then set up html, then fetch data from the ODB, then parse it and sort it into the table
            Promise.all(templates.map(promisePartial)
                ).then(
                    function(partials){
                        var i;

                        //save for later
                        dataStore.partials = {};
                        for(i=0; i<templates.length; i++){
                            dataStore.partials[templates[i]] = partials[i];
                        }

                        //set up html
                        document.getElementById('leftTable').innerHTML = Mustache.to_html(
                                partials[0],
                                {
                                    "words" : words.slice(0,8)
                                }
                            )

                        document.getElementById('rightTable').innerHTML = Mustache.to_html(
                                partials[0],
                                {
                                    "words" : words.slice(8)
                                }
                            )
                    }
                ).then(
                    function(){
                        //promiseScript(ODBrequest)

                        //testing implementation until events are available in odb
                        var testingData = [
                                0x88B67C80,
                                0x00850F81,
                                0x56007C84,
                                0x900461FF,
                                0xA074A998,
                                0xB074A998,
                                0xD00461FF,
                                0xC57715CC,
                                0x2074A998,
                                0x5874A998,
                                0x2074A998,
                                0x5874A998,
                                0x2074A998,
                                0x5874A998,
                                0xD0000000
                            ];

                        parseODB(testingData)
                    }
                )




        </script>

    </body>
</html>